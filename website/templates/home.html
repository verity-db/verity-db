{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<!-- Hero -->
<section class="hero" data-variant="inverted">
  <div class="wrapper">
    <div class="flow" data-space="xl">
      <span class="badge" data-variant="alert">Under Active Development</span>
      <h1 class="hero__title">
        <span class="highlight">The Compliance-</span><br>
        <span class="highlight">First Database</span>
      </h1>
      <p class="hero__lede">
        For industries where data integrity is non-negotiable.
      </p>
      <div class="cluster">
        <a href="https://github.com/craton-db/craton" class="button" data-variant="light">
          <svg class="button__icon" aria-hidden="true">
            <use href="/public/icons/sustyicons-all-v1-1.svg#github"></use>
          </svg>
          View on GitHub
        </a>
        <a href="#sql-pipeline" class="button" data-variant="ghost-light">
          See It In Action
        </a>
      </div>
    </div>
  </div>
</section>

<!-- The Problem - Write Path Comparison -->
<section class="interactive-section" id="the-problem" aria-labelledby="problem-heading">
  <div class="wrapper">
    <header class="interactive-section__header flow" data-space="m">
      <h2 id="problem-heading" class="section-title">Building for Compliance Is Hard</h2>
      <p class="section-subtitle">
        When your application handles PHI, financial records, or regulated data,
        you need infrastructure that auditors will accept. That means you need to build:
      </p>
      <div class="feature-list flow" data-space="2xs" style="padding-inline-start: var(--space-m);">
        <div class="feature-list__item">
          <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
          <span>Immutable audit trails for every change</span>
        </div>
        <div class="feature-list__item">
          <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
          <span>Cryptographic proof of data integrity</span>
        </div>
        <div class="feature-list__item">
          <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
          <span>Per-tenant encryption and isolation</span>
        </div>
        <div class="feature-list__item">
          <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
          <span>Point-in-time reconstruction</span>
        </div>
      </div>
      <p class="text-muted">
        Most teams bolt these onto existing databases. <strong>Craton does this for you.</strong>
      </p>
      <a href="#path-comparison-figure" class="scroll-indicator">
        <span class="scroll-indicator__text">Here's how:</span>
        <span class="scroll-indicator__arrow" aria-hidden="true">&#x2193;</span>
      </a>
    </header>

    <figure
      class="interactive-section__figure"
      id="path-comparison-figure"
      data-signals="{
        isRunning: false,
        tradStep: -1,
        cratonStep: -1,
        tradTime: 0,
        cratonTime: 0,
        tradComplete: false,
        cratonComplete: false
      }"
    >
      <header class="interactive-section__figure-header">
        <span class="interactive-section__fig-label">Fig. 1</span>
        <span class="interactive-section__fig-caption">Dashed borders = steps you build and maintain. Double borders = built-in.</span>
      </header>

      <div class="interactive-section__figure-content flow" data-space="m">
        <div class="cluster" data-justify="center">
          <button
            class="interactive-button"
            data-variant="primary"
            data-attr:disabled="$isRunning"
            data-on:click="
              $isRunning = true;
              $tradStep = -1; $cratonStep = -1;
              $tradTime = 0; $cratonTime = 0;
              $tradComplete = false; $cratonComplete = false;

              const tradTimes = [0.1, 0.3, 0.2, 0.4, 0.3, 0.1, 0.2, 0.1];
              const cratonTimes = [0.1, 0.2, 0.3, 0.1, 0.1];

              let tradIdx = 0;
              let cratonIdx = 0;

              const runTrad = () => {
                if (tradIdx < tradTimes.length) {
                  $tradStep = tradIdx;
                  $tradTime = $tradTime + tradTimes[tradIdx];
                  tradIdx++;
                  setTimeout(runTrad, 180);
                } else {
                  $tradComplete = true;
                  checkDone();
                }
              };

              const runCraton = () => {
                if (cratonIdx < cratonTimes.length) {
                  $cratonStep = cratonIdx;
                  $cratonTime = $cratonTime + cratonTimes[cratonIdx];
                  cratonIdx++;
                  setTimeout(runCraton, 140);
                } else {
                  $cratonComplete = true;
                  checkDone();
                }
              };

              const checkDone = () => {
                if ($tradComplete && $cratonComplete) {
                  $isRunning = false;
                }
              };

              setTimeout(runTrad, 100);
              setTimeout(runCraton, 100);
            "
          >
            <span data-show="!$isRunning">Run Write</span>
            <span data-show="$isRunning">Running...</span>
          </button>

          <button
            class="interactive-button"
            data-on:click="
              $isRunning = false;
              $tradStep = -1; $cratonStep = -1;
              $tradTime = 0; $cratonTime = 0;
              $tradComplete = false; $cratonComplete = false;
            "
          >
            <svg class="interactive-button__icon" viewBox="0 0 128 128" aria-hidden="true"><use href="/public/icons/sustyicons-all-v1-1.svg#arrow-undo-restore"></use></svg>
            Reset
          </button>
        </div>

        <div class="path-comparison">
          {# Side-by-side grid #}
          <div class="path-comparison__grid">
            {# Traditional DB Column #}
            <div class="path-comparison__column" data-variant="traditional">
              <div class="path-comparison__header">
                <span class="path-comparison__title">PostgreSQL + Bolt-ons</span>
                <span class="path-comparison__badge cluster">
                  <span data-show="$tradComplete">&#x2713;</span>
                  <span>8 steps</span>
                </span>
              </div>

              <div class="path-comparison__stages">
                <div class="path-comparison__stage" data-attr:data-state="$tradStep === 0 ? 'active' : ($tradStep > 0 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">1</div>
                  <span class="path-comparison__label">Receive</span>
                </div>
                <div class="path-comparison__connector" data-type="bolted" data-attr:data-state="$tradStep >= 1 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="bolted" data-attr:data-state="$tradStep === 1 ? 'active' : ($tradStep > 1 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">2</div>
                  <span class="path-comparison__label">Audit</span>
                </div>
                <div class="path-comparison__connector" data-type="bolted" data-attr:data-state="$tradStep >= 2 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="bolted" data-attr:data-state="$tradStep === 2 ? 'active' : ($tradStep > 2 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">3</div>
                  <span class="path-comparison__label">Encrypt</span>
                </div>
                <div class="path-comparison__connector" data-attr:data-state="$tradStep >= 3 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-attr:data-state="$tradStep === 3 ? 'active' : ($tradStep > 3 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">4</div>
                  <span class="path-comparison__label">Write</span>
                </div>
                <div class="path-comparison__connector" data-type="bolted" data-attr:data-state="$tradStep >= 4 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="bolted" data-attr:data-state="$tradStep === 4 ? 'active' : ($tradStep > 4 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">5</div>
                  <span class="path-comparison__label">Audit DB</span>
                </div>
                <div class="path-comparison__connector" data-type="bolted" data-attr:data-state="$tradStep >= 5 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="bolted" data-attr:data-state="$tradStep === 5 ? 'active' : ($tradStep > 5 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">6</div>
                  <span class="path-comparison__label">Hash</span>
                </div>
                <div class="path-comparison__connector" data-type="bolted" data-attr:data-state="$tradStep >= 6 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="bolted" data-attr:data-state="$tradStep === 6 ? 'active' : ($tradStep > 6 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">7</div>
                  <span class="path-comparison__label">Store</span>
                </div>
                <div class="path-comparison__connector" data-attr:data-state="$tradStep >= 7 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-attr:data-state="$tradStep === 7 ? 'active' : ($tradStep > 7 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">&#x2713;</div>
                  <span class="path-comparison__label">Done</span>
                </div>
              </div>

              <div class="path-comparison__progress">
                <div class="path-comparison__progress-bar" data-attr:style="'width: ' + (($tradStep + 1) / 8 * 100) + '%'"></div>
              </div>

              <div class="path-comparison__footer">
                <span class="path-comparison__timer" data-attr:data-status="$tradComplete ? 'complete' : ($tradStep >= 0 ? 'running' : '')" data-text="$tradTime.toFixed(1) + 'ms'">0.0ms</span>
              </div>
            </div>

            {# Craton Column #}
            <div class="path-comparison__column" data-variant="craton">
              <div class="path-comparison__header">
                <span class="path-comparison__title">Craton</span>
                <span class="path-comparison__badge cluster">
                  <span data-show="$cratonComplete">&#x2713;</span>
                  <span>5 steps</span>
                </span>
              </div>

              <div class="path-comparison__stages">
                <div class="path-comparison__stage" data-attr:data-state="$cratonStep === 0 ? 'active' : ($cratonStep > 0 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">1</div>
                  <span class="path-comparison__label">Receive</span>
                </div>
                <div class="path-comparison__connector" data-attr:data-state="$cratonStep >= 1 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="builtin" data-attr:data-state="$cratonStep === 1 ? 'active' : ($cratonStep > 1 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">2</div>
                  <span class="path-comparison__label">Validate</span>
                </div>
                <div class="path-comparison__connector" data-attr:data-state="$cratonStep >= 2 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="builtin" data-attr:data-state="$cratonStep === 2 ? 'active' : ($cratonStep > 2 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">3</div>
                  <span class="path-comparison__label">Append</span>
                </div>
                <div class="path-comparison__connector" data-attr:data-state="$cratonStep >= 3 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-type="builtin" data-attr:data-state="$cratonStep === 3 ? 'active' : ($cratonStep > 3 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">4</div>
                  <span class="path-comparison__label">Project</span>
                </div>
                <div class="path-comparison__connector" data-attr:data-state="$cratonStep >= 4 ? 'completed' : 'pending'">
                  <svg viewBox="0 0 20 12"><line x1="0" y1="6" x2="14" y2="6"/><polyline points="11,3 16,6 11,9"/></svg>
                </div>
                <div class="path-comparison__stage" data-attr:data-state="$cratonStep === 4 ? 'active' : ($cratonStep > 4 ? 'completed' : 'pending')">
                  <div class="path-comparison__dot">&#x2713;</div>
                  <span class="path-comparison__label">Done</span>
                </div>
              </div>

              <div class="path-comparison__progress">
                <div class="path-comparison__progress-bar" data-attr:style="'width: ' + (($cratonStep + 1) / 5 * 100) + '%'"></div>
              </div>

              <div class="path-comparison__footer">
                <span class="path-comparison__timer" data-attr:data-status="$cratonComplete ? 'complete' : ($cratonStep >= 0 ? 'running' : '')" data-text="$cratonTime.toFixed(1) + 'ms'">0.0ms</span>
              </div>
            </div>
          </div>

          <div class="path-comparison__legend">
            <span class="path-comparison__legend-item">
              <span class="path-comparison__legend-dot" data-type="core"></span>
              Core
            </span>
            <span class="path-comparison__legend-item">
              <span class="path-comparison__legend-dot" data-type="builtin"></span>
              Built-in
            </span>
            <span class="path-comparison__legend-item">
              <span class="path-comparison__legend-dot" data-type="bolted"></span>
              You maintain
            </span>
          </div>
        </div>
      </div>
    </figure>

    <p class="text-muted mt-l" style="text-align: center;">
      Building compliance yourself means <strong>5+ bolt-on components</strong> to maintain.
      Craton has it all built-in&mdash;and it's still fast.
    </p>
  </div>
</section>

<!-- Philosophy Quote -->
<section class="quote-section">
  <div class="wrapper">
    <blockquote class="pullquote">
      <p>
        <span class="word">All</span>
        <span class="word">data</span>
        <span class="word">is</span>
        <span class="word">an</span>
        <span class="word">immutable,</span>
        <span class="word">ordered</span>
        <span class="word">log.</span>
        <span class="word">All</span>
        <span class="word">state</span>
        <span class="word">is</span>
        <span class="word">a</span>
        <span class="word">derived</span>
        <span class="word">view.</span>
      </p>
    </blockquote>
  </div>
</section>

<!-- SQL → Event → Projection Pipeline (CLI Terminal) - MOVED UP -->
{% include "partials/figures/sql-pipeline.html" %}

<!-- Audit Trail Timeline -->
<section class="interactive-section" id="audit" aria-labelledby="audit-heading">
  <div class="wrapper">
    <header class="interactive-section__header flow" data-space="s">
      <h2 id="audit-heading" class="section-title">Complete Audit Trail</h2>
      <p class="section-subtitle">
        Every action recorded. Every change traceable.
        <strong>Answer any auditor's question instantly.</strong>
      </p>
    </header>

    <figure
      class="interactive-section__figure"
      data-signals="{
        showCreate: true,
        showUpdate: true,
        showAccess: true,
        replayIndex: -1,
        isPlaying: false,
        scrollPos: 0
      }"
    >
      <header class="interactive-section__figure-header">
        <span class="interactive-section__fig-label">Fig. 3</span>
        <span class="interactive-section__fig-caption">Filter by event type or use playback controls to watch events unfold.</span>
      </header>

      <div class="interactive-section__figure-content">
        <div class="audit-timeline">
          <!-- Controls and Filters -->
          <div class="audit-timeline__filters">
            <div class="audit-timeline__controls">
              <!-- Play button -->
              <button
                class="interactive-button"
                data-attr:data-state="$isPlaying ? 'playing' : 'stopped'"
                data-on:click="
                  if ($isPlaying) return;
                  const container = document.querySelector('.audit-timeline__events');
                  if (window.replayTimeout) clearTimeout(window.replayTimeout);
                  $isPlaying = true;
                  $replayIndex = 0;
                  if (container) container.scrollTo({ left: 0, behavior: 'instant' });
                  const step = () => {
                    if (!$isPlaying) return;
                    const event = document.querySelector('.audit-timeline__event[style*=\'--index: ' + $replayIndex + '\']');
                    if (event && container) {
                      event.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                    if ($replayIndex < 9) {
                      window.replayTimeout = setTimeout(() => {
                        $replayIndex++;
                        step();
                      }, 280);
                    } else {
                      window.replayTimeout = setTimeout(() => {
                        $replayIndex = -1;
                        $isPlaying = false;
                      }, 400);
                    }
                  };
                  step();
                "
              >
                <span data-show="!$isPlaying">&#x25B6; Play</span>
                <span data-show="$isPlaying">Playing...</span>
              </button>
            </div>

            <fieldset class="audit-timeline__filter-group">
              <legend>Filter:</legend>
              <label>
                <input type="checkbox" data-bind:show-create>
                Creates
              </label>
              <label>
                <input type="checkbox" data-bind:show-update>
                Updates
              </label>
              <label>
                <input type="checkbox" data-bind:show-access>
                Access
              </label>
            </fieldset>
          </div>

          <!-- Timeline Events - horizontal -->
          <div class="audit-timeline__events">
          <article
            class="audit-timeline__event"
            data-action="create"
            style="--index: 0"
            data-show="$showCreate"
            data-attr:data-replaying="$replayIndex === 0"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">StreamCreated</span>
                <time class="audit-timeline__event-time">2024-01-15 09:15:32 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>system</dd>
                <dt>Correlation ID</dt>
                <dd>7f3a2b1c</dd>
                <dt>Stream</dt>
                <dd>patient_records</dd>
                <dt>Tenant</dt>
                <dd>healthcare_co</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="create"
            style="--index: 1"
            data-show="$showCreate"
            data-attr:data-replaying="$replayIndex === 1"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordCreated</span>
                <time class="audit-timeline__event-time">2024-01-15 09:16:45 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>nurse_jane</dd>
                <dt>Correlation ID</dt>
                <dd>a9c8d4e2</dd>
                <dt>Record Type</dt>
                <dd>vitals</dd>
                <dt>Patient ID</dt>
                <dd>P-12345</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="update"
            style="--index: 2"
            data-show="$showUpdate"
            data-attr:data-replaying="$replayIndex === 2"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordUpdated</span>
                <time class="audit-timeline__event-time">2024-01-15 09:18:02 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>dr_smith</dd>
                <dt>Correlation ID</dt>
                <dd>b5e7f1a3</dd>
                <dt>Fields Changed</dt>
                <dd>blood_pressure</dd>
                <dt>Previous Hash</dt>
                <dd>a9c8d4e2</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="access"
            style="--index: 3"
            data-show="$showAccess"
            data-attr:data-replaying="$replayIndex === 3"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordAccessed</span>
                <time class="audit-timeline__event-time">2024-01-15 09:25:33 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>dr_smith</dd>
                <dt>Correlation ID</dt>
                <dd>c2d9e8f4</dd>
                <dt>Access Type</dt>
                <dd>read</dd>
                <dt>IP Address</dt>
                <dd>10.0.1.42</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="access"
            style="--index: 4"
            data-show="$showAccess"
            data-attr:data-replaying="$replayIndex === 4"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordAccessed</span>
                <time class="audit-timeline__event-time">2024-01-15 10:45:12 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>nurse_jane</dd>
                <dt>Correlation ID</dt>
                <dd>d3e0f9a5</dd>
                <dt>Access Type</dt>
                <dd>chart_review</dd>
                <dt>Patient ID</dt>
                <dd>P-12345</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="create"
            style="--index: 5"
            data-show="$showCreate"
            data-attr:data-replaying="$replayIndex === 5"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordCreated</span>
                <time class="audit-timeline__event-time">2024-01-15 11:02:33 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>lab_tech</dd>
                <dt>Correlation ID</dt>
                <dd>e4f1a0b6</dd>
                <dt>Record Type</dt>
                <dd>lab_results</dd>
                <dt>Patient ID</dt>
                <dd>P-12345</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="update"
            style="--index: 6"
            data-show="$showUpdate"
            data-attr:data-replaying="$replayIndex === 6"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordUpdated</span>
                <time class="audit-timeline__event-time">2024-01-15 11:30:45 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>dr_smith</dd>
                <dt>Correlation ID</dt>
                <dd>f5g2b1c7</dd>
                <dt>Fields Changed</dt>
                <dd>diagnosis</dd>
                <dt>Previous Hash</dt>
                <dd>e4f1a0b6</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="update"
            style="--index: 7"
            data-show="$showUpdate"
            data-attr:data-replaying="$replayIndex === 7"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordUpdated</span>
                <time class="audit-timeline__event-time">2024-01-15 12:15:08 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>pharmacy_sys</dd>
                <dt>Correlation ID</dt>
                <dd>g6h3c2d8</dd>
                <dt>Fields Changed</dt>
                <dd>rx_status</dd>
                <dt>Previous Hash</dt>
                <dd>f5g2b1c7</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="access"
            style="--index: 8"
            data-show="$showAccess"
            data-attr:data-replaying="$replayIndex === 8"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">RecordAccessed</span>
                <time class="audit-timeline__event-time">2024-01-15 14:00:22 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>compliance_officer</dd>
                <dt>Correlation ID</dt>
                <dd>h7i4d3e9</dd>
                <dt>Access Type</dt>
                <dd>audit_review</dd>
                <dt>IP Address</dt>
                <dd>10.0.2.15</dd>
              </dl>
            </div>
          </article>

          <article
            class="audit-timeline__event"
            data-action="access"
            style="--index: 9"
            data-show="$showAccess"
            data-attr:data-replaying="$replayIndex === 9"
          >
            <div class="audit-timeline__event-card">
              <header class="audit-timeline__event-header">
                <span class="audit-timeline__event-action">ExportRequested</span>
                <time class="audit-timeline__event-time">2024-01-15 14:30:00 UTC</time>
              </header>
              <dl class="audit-timeline__event-details">
                <dt>Actor</dt>
                <dd>compliance_officer</dd>
                <dt>Correlation ID</dt>
                <dd>i8j5e4f0</dd>
                <dt>Export Format</dt>
                <dd>signed_json</dd>
                <dt>Records</dt>
                <dd>10</dd>
              </dl>
            </div>
          </article>
          </div>
        </div>
      </div>

      <div class="interactive-section__figure-footer">
        <div class="interactive-section__legend">
          <span class="legend-item">
            <span class="legend-swatch" data-action="create"></span>
            Create
          </span>
          <span class="legend-item">
            <span class="legend-swatch" data-action="update"></span>
            Update
          </span>
          <span class="legend-item">
            <span class="legend-swatch" data-action="access"></span>
            Access
          </span>
        </div>
      </div>
    </figure>
  </div>
</section>

<!-- Time Travel Query Explorer -->
{% include "partials/figures/time-travel.html" %}

<!-- Multi-Tenant Isolation -->
<section class="interactive-section" id="tenants" aria-labelledby="tenants-heading">
  <div class="wrapper">
    <header class="interactive-section__header flow" data-space="s">
      <h2 id="tenants-heading" class="section-title">Tenant Isolation by Design</h2>
      <p class="section-subtitle">
        Each tenant's data is cryptographically isolated.
        <strong>Cross-tenant access is impossible by construction.</strong>
      </p>
    </header>

    <figure class="interactive-section__figure" data-signals="{ expandedTenant: 'healthcare' }">
      <header class="interactive-section__figure-header">
        <span class="interactive-section__fig-label">Fig. 5</span>
        <span class="interactive-section__fig-caption">Each tenant's encryption keys are completely isolated.</span>
      </header>

      <div class="interactive-section__figure-content">
        <div class="tenant-vaults">
          <!-- Healthcare Tenant -->
          <article
            class="tenant-vault"
            data-tenant="healthcare"
            data-attr:data-expanded="$expandedTenant === 'healthcare' ? 'true' : 'false'"
            data-on:click__viewtransition="$expandedTenant = $expandedTenant === 'healthcare' ? '' : 'healthcare'"
            tabindex="0"
            role="button"
            style="view-transition-name: tenant-healthcare"
          >
            <!-- Preview: always visible -->
            <div class="tenant-vault__preview">
              <div class="tenant-vault__icon" aria-hidden="true">H</div>
              <span class="tenant-vault__preview-label">Healthcare Co</span>
            </div>

            <!-- Content: shown when expanded -->
            <div class="tenant-vault__content" data-show="$expandedTenant === 'healthcare'">
              <header class="tenant-vault__header">
                <h3 class="tenant-vault__name">Healthcare Co</h3>
              </header>

              <div class="tenant-vault__badges">
                <span class="tenant-vault__badge">PHI</span>
                <span class="tenant-vault__badge">HIPAA</span>
                <span class="tenant-vault__badge">us-east-1</span>
              </div>

              <div class="tenant-vault__data-bars" aria-hidden="true">
                <div class="tenant-vault__data-bar" style="--fill: 85%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 60%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 92%"></div>
              </div>

              <div class="tenant-vault__key-hierarchy" aria-label="Encryption key hierarchy">
                <div class="tenant-vault__key-level" style="--level: 0">
                  <div class="tenant-vault__key-icon" aria-hidden="true">M</div>
                  <div class="tenant-vault__key-label">
                    <strong>Master Key</strong>
                    <span>AWS KMS / HSM</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 1">
                  <div class="tenant-vault__key-icon" aria-hidden="true">K</div>
                  <div class="tenant-vault__key-label">
                    <strong>Key Encryption Key</strong>
                    <span>Per-tenant, wrapped</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 2">
                  <div class="tenant-vault__key-icon" aria-hidden="true">D</div>
                  <div class="tenant-vault__key-label">
                    <strong>Data Encryption Key</strong>
                    <span>AES-256-GCM</span>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Finance Tenant -->
          <article
            class="tenant-vault"
            data-tenant="finance"
            data-attr:data-expanded="$expandedTenant === 'finance' ? 'true' : 'false'"
            data-on:click__viewtransition="$expandedTenant = $expandedTenant === 'finance' ? '' : 'finance'"
            tabindex="0"
            role="button"
            style="view-transition-name: tenant-finance"
          >
            <!-- Preview: always visible -->
            <div class="tenant-vault__preview">
              <div class="tenant-vault__icon" aria-hidden="true">F</div>
              <span class="tenant-vault__preview-label">FinanceOrg</span>
            </div>

            <!-- Content: shown when expanded -->
            <div class="tenant-vault__content">
              <header class="tenant-vault__header">
                <h3 class="tenant-vault__name">FinanceOrg</h3>
              </header>

              <div class="tenant-vault__badges">
                <span class="tenant-vault__badge">PCI-DSS</span>
                <span class="tenant-vault__badge">SOX</span>
                <span class="tenant-vault__badge">eu-west-1</span>
              </div>

              <div class="tenant-vault__data-bars" aria-hidden="true">
                <div class="tenant-vault__data-bar" style="--fill: 70%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 88%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 55%"></div>
              </div>

              <div class="tenant-vault__key-hierarchy" aria-label="Encryption key hierarchy">
                <div class="tenant-vault__key-level" style="--level: 0">
                  <div class="tenant-vault__key-icon" aria-hidden="true">M</div>
                  <div class="tenant-vault__key-label">
                    <strong>Master Key</strong>
                    <span>Azure Key Vault</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 1">
                  <div class="tenant-vault__key-icon" aria-hidden="true">K</div>
                  <div class="tenant-vault__key-label">
                    <strong>Key Encryption Key</strong>
                    <span>Per-tenant, wrapped</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 2">
                  <div class="tenant-vault__key-icon" aria-hidden="true">D</div>
                  <div class="tenant-vault__key-label">
                    <strong>Data Encryption Key</strong>
                    <span>AES-256-GCM</span>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Legal Tenant -->
          <article
            class="tenant-vault"
            data-tenant="legal"
            data-attr:data-expanded="$expandedTenant === 'legal' ? 'true' : 'false'"
            data-on:click__viewtransition="$expandedTenant = $expandedTenant === 'legal' ? '' : 'legal'"
            tabindex="0"
            role="button"
            style="view-transition-name: tenant-legal"
          >
            <!-- Preview: always visible -->
            <div class="tenant-vault__preview">
              <div class="tenant-vault__icon" aria-hidden="true">L</div>
              <span class="tenant-vault__preview-label">LegalFirm LLP</span>
            </div>

            <!-- Content: shown when expanded -->
            <div class="tenant-vault__content">
              <header class="tenant-vault__header">
                <h3 class="tenant-vault__name">LegalFirm LLP</h3>
              </header>

              <div class="tenant-vault__badges">
                <span class="tenant-vault__badge">Privilege</span>
                <span class="tenant-vault__badge">eDiscovery</span>
                <span class="tenant-vault__badge">us-west-2</span>
              </div>

              <div class="tenant-vault__data-bars" aria-hidden="true">
                <div class="tenant-vault__data-bar" style="--fill: 45%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 78%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 65%"></div>
              </div>

              <div class="tenant-vault__key-hierarchy" aria-label="Encryption key hierarchy">
                <div class="tenant-vault__key-level" style="--level: 0">
                  <div class="tenant-vault__key-icon" aria-hidden="true">M</div>
                  <div class="tenant-vault__key-label">
                    <strong>Master Key</strong>
                    <span>On-premise HSM</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 1">
                  <div class="tenant-vault__key-icon" aria-hidden="true">K</div>
                  <div class="tenant-vault__key-label">
                    <strong>Key Encryption Key</strong>
                    <span>Per-tenant, wrapped</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 2">
                  <div class="tenant-vault__key-icon" aria-hidden="true">D</div>
                  <div class="tenant-vault__key-label">
                    <strong>Data Encryption Key</strong>
                    <span>AES-256-GCM</span>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Government Tenant -->
          <article
            class="tenant-vault"
            data-tenant="government"
            data-attr:data-expanded="$expandedTenant === 'government' ? 'true' : 'false'"
            data-on:click__viewtransition="$expandedTenant = $expandedTenant === 'government' ? '' : 'government'"
            tabindex="0"
            role="button"
            style="view-transition-name: tenant-government"
          >
            <!-- Preview: always visible -->
            <div class="tenant-vault__preview">
              <div class="tenant-vault__icon" aria-hidden="true">G</div>
              <span class="tenant-vault__preview-label">GovAgency</span>
            </div>

            <!-- Content: shown when expanded -->
            <div class="tenant-vault__content">
              <header class="tenant-vault__header">
                <h3 class="tenant-vault__name">GovAgency</h3>
              </header>

              <div class="tenant-vault__badges">
                <span class="tenant-vault__badge">FedRAMP</span>
                <span class="tenant-vault__badge">FISMA</span>
                <span class="tenant-vault__badge">us-gov-west</span>
              </div>

              <div class="tenant-vault__data-bars" aria-hidden="true">
                <div class="tenant-vault__data-bar" style="--fill: 95%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 82%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 78%"></div>
              </div>

              <div class="tenant-vault__key-hierarchy" aria-label="Encryption key hierarchy">
                <div class="tenant-vault__key-level" style="--level: 0">
                  <div class="tenant-vault__key-icon" aria-hidden="true">M</div>
                  <div class="tenant-vault__key-label">
                    <strong>Master Key</strong>
                    <span>FIPS 140-2 HSM</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 1">
                  <div class="tenant-vault__key-icon" aria-hidden="true">K</div>
                  <div class="tenant-vault__key-label">
                    <strong>Key Encryption Key</strong>
                    <span>Per-tenant, wrapped</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 2">
                  <div class="tenant-vault__key-icon" aria-hidden="true">D</div>
                  <div class="tenant-vault__key-label">
                    <strong>Data Encryption Key</strong>
                    <span>AES-256-GCM</span>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Retail Tenant -->
          <article
            class="tenant-vault"
            data-tenant="retail"
            data-attr:data-expanded="$expandedTenant === 'retail' ? 'true' : 'false'"
            data-on:click__viewtransition="$expandedTenant = $expandedTenant === 'retail' ? '' : 'retail'"
            tabindex="0"
            role="button"
            style="view-transition-name: tenant-retail"
          >
            <!-- Preview: always visible -->
            <div class="tenant-vault__preview">
              <div class="tenant-vault__icon" aria-hidden="true">R</div>
              <span class="tenant-vault__preview-label">RetailCorp</span>
            </div>

            <!-- Content: shown when expanded -->
            <div class="tenant-vault__content">
              <header class="tenant-vault__header">
                <h3 class="tenant-vault__name">RetailCorp</h3>
              </header>

              <div class="tenant-vault__badges">
                <span class="tenant-vault__badge">PCI</span>
                <span class="tenant-vault__badge">GDPR</span>
                <span class="tenant-vault__badge">eu-central-1</span>
              </div>

              <div class="tenant-vault__data-bars" aria-hidden="true">
                <div class="tenant-vault__data-bar" style="--fill: 62%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 91%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 47%"></div>
              </div>

              <div class="tenant-vault__key-hierarchy" aria-label="Encryption key hierarchy">
                <div class="tenant-vault__key-level" style="--level: 0">
                  <div class="tenant-vault__key-icon" aria-hidden="true">M</div>
                  <div class="tenant-vault__key-label">
                    <strong>Master Key</strong>
                    <span>GCP Cloud KMS</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 1">
                  <div class="tenant-vault__key-icon" aria-hidden="true">K</div>
                  <div class="tenant-vault__key-label">
                    <strong>Key Encryption Key</strong>
                    <span>Per-tenant, wrapped</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 2">
                  <div class="tenant-vault__key-icon" aria-hidden="true">D</div>
                  <div class="tenant-vault__key-label">
                    <strong>Data Encryption Key</strong>
                    <span>AES-256-GCM</span>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Insurance Tenant -->
          <article
            class="tenant-vault"
            data-tenant="insurance"
            data-attr:data-expanded="$expandedTenant === 'insurance' ? 'true' : 'false'"
            data-on:click__viewtransition="$expandedTenant = $expandedTenant === 'insurance' ? '' : 'insurance'"
            tabindex="0"
            role="button"
            style="view-transition-name: tenant-insurance"
          >
            <!-- Preview: always visible -->
            <div class="tenant-vault__preview">
              <div class="tenant-vault__icon" aria-hidden="true">I</div>
              <span class="tenant-vault__preview-label">InsureCo</span>
            </div>

            <!-- Content: shown when expanded -->
            <div class="tenant-vault__content">
              <header class="tenant-vault__header">
                <h3 class="tenant-vault__name">InsureCo</h3>
              </header>

              <div class="tenant-vault__badges">
                <span class="tenant-vault__badge">SOC 2</span>
                <span class="tenant-vault__badge">NAIC</span>
                <span class="tenant-vault__badge">ap-south-1</span>
              </div>

              <div class="tenant-vault__data-bars" aria-hidden="true">
                <div class="tenant-vault__data-bar" style="--fill: 73%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 58%"></div>
                <div class="tenant-vault__data-bar" style="--fill: 84%"></div>
              </div>

              <div class="tenant-vault__key-hierarchy" aria-label="Encryption key hierarchy">
                <div class="tenant-vault__key-level" style="--level: 0">
                  <div class="tenant-vault__key-icon" aria-hidden="true">M</div>
                  <div class="tenant-vault__key-label">
                    <strong>Master Key</strong>
                    <span>HashiCorp Vault</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 1">
                  <div class="tenant-vault__key-icon" aria-hidden="true">K</div>
                  <div class="tenant-vault__key-label">
                    <strong>Key Encryption Key</strong>
                    <span>Per-tenant, wrapped</span>
                  </div>
                </div>
                <div class="tenant-vault__key-level" style="--level: 2">
                  <div class="tenant-vault__key-icon" aria-hidden="true">D</div>
                  <div class="tenant-vault__key-label">
                    <strong>Data Encryption Key</strong>
                    <span>AES-256-GCM</span>
                  </div>
                </div>
              </div>
            </div>
          </article>
        </div>
      </div>
    </figure>
  </div>
</section>

<!-- Performance Stats -->
<section class="interactive-section" id="performance" aria-labelledby="performance-heading">
  <div class="wrapper">
    <header class="interactive-section__header flow" data-space="s">
      <h2 id="performance-heading" class="section-title">Compliance Without Compromise</h2>
      <p class="section-subtitle">
        Craton is engineered for production workloads.
        <strong>No artificial slowdowns. No "compliance mode" toggles.</strong>
      </p>
    </header>

    <figure
      class="interactive-section__figure"
      id="performance-figure"
      data-signals="{ tpsValue: 0, writeValue: 1000, readValue: 100000, hasAnimated: false }"
      data-on-intersect__half__once="
        if ($hasAnimated) return;
        $hasAnimated = true;
        const duration = 1000;
        const startTime = performance.now();
        const easeOutCubic = t => 1 - Math.pow(1 - t, 3);
        const animate = (now) => {
          const elapsed = now - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const eased = easeOutCubic(progress);
          $tpsValue = Math.round(eased * 100);
          $writeValue = Math.round(1000 - eased * 999);
          $readValue = Math.round(100000 - eased * 99900);
          if (progress < 1) requestAnimationFrame(animate);
        };
        requestAnimationFrame(animate);
      "
    >
      <header class="interactive-section__figure-header">
        <span class="interactive-section__fig-label">Fig. 6</span>
        <span class="interactive-section__fig-caption">Production-grade performance with full compliance guarantees.</span>
      </header>

      <div class="interactive-section__figure-content">
        <div class="performance-stats">
          <div class="performance-stats__grid">
            <div class="performance-stats__card">
              <span class="performance-stats__value" data-text="$tpsValue + 'K+'">0K+</span>
              <span class="performance-stats__label">TPS with fsync</span>
              <span class="performance-stats__detail">Write throughput</span>
            </div>
            <div class="performance-stats__card">
              <span class="performance-stats__value" data-text="'<' + $writeValue + 'ms'">&lt;1000ms</span>
              <span class="performance-stats__label">p99 latency</span>
              <span class="performance-stats__detail">Write operations</span>
            </div>
            <div class="performance-stats__card">
              <span class="performance-stats__value" data-text="'<' + $readValue + 'µs'">&lt;100000µs</span>
              <span class="performance-stats__label">p99 latency</span>
              <span class="performance-stats__detail">Indexed reads</span>
            </div>
            <div class="performance-stats__card">
              <span class="performance-stats__value">O(1)</span>
              <span class="performance-stats__label">Verification</span>
              <span class="performance-stats__detail">Via checkpoints</span>
            </div>
          </div>
          <p class="performance-stats__footnote text-muted">
            SHA-256 where compliance requires it. BLAKE3 where speed matters.
          </p>
        </div>
      </div>
    </figure>
  </div>
</section>


<!-- Mutable vs Immutable Comparison Slider -->
{% include "partials/figures/comparison-slider.html" %}

<!-- Technical Deep Dives -->
<section class="interactive-section" id="deep-dives" aria-labelledby="deep-dives-heading">
  <div class="wrapper">
    <header class="interactive-section__header flow" data-space="s">
      <h2 id="deep-dives-heading" class="section-title">Under the Hood</h2>
      <p class="section-subtitle">
        Explore the implementation details that make Craton work.
      </p>
    </header>

    <div class="flow" data-space="xl">
      <!-- Hash Chain Visualization -->
      <div class="deep-dive-section" id="hash-chain">
        <h3 class="deep-dive-section__title">Tamper-Evident Audit Trail</h3>
        <p class="text-muted mb-m">
          Each record cryptographically links to the previous.
          <strong>Change one byte, break the entire chain.</strong>
        </p>

          <figure
            class="interactive-section__figure"
            data-signals="{
              b0data: 'genesis',
              b1data: 'patient_created',
              b2data: 'lab_results',
              b3data: 'prescription',
              b0state: 'genesis',
              b1state: 'valid',
              b2state: 'valid',
              b3state: 'valid'
            }"
          >
            <header class="interactive-section__figure-header">
              <span class="interactive-section__fig-label">Fig. 8</span>
              <span class="interactive-section__fig-caption">Click "Tamper" to modify a record. All subsequent hashes become invalid.</span>
            </header>

            <div class="interactive-section__figure-content">
              <div class="hash-chain" role="img" aria-label="Interactive hash chain demonstration">
                <!-- Block 0: Genesis -->
                <article class="hash-chain__row" data-attr:data-state="$b0state">
                  <span class="hash-chain__index">#0</span>
                  <div class="hash-chain__hash" title="SHA-256 hash">
                    <code>7f3a2b1c...</code>
                  </div>
                  <div class="hash-chain__data">
                    <span class="hash-chain__data-value" data-text="$b0data">genesis</span>
                    <button
                      class="hash-chain__tamper-btn"
                      data-on:click="$b0data = $b0data + '*'; $b1state = 'invalid'; $b2state = 'invalid'; $b3state = 'invalid'"
                      title="Tamper with this record"
                    >Tamper</button>
                    <span class="hash-chain__invalid-icon" aria-label="Invalid">&#x2717;</span>
                  </div>
                  <div class="hash-chain__formula">H(data)</div>
                </article>

                <div class="hash-chain__connector" data-attr:data-state="$b1state" aria-hidden="true">
                  <div class="hash-chain__flow-line"></div>
                </div>

                <!-- Block 1 -->
                <article class="hash-chain__row" data-attr:data-state="$b1state">
                  <span class="hash-chain__index">#1</span>
                  <div class="hash-chain__hash">
                    <code>a9c8d4e2...</code>
                  </div>
                  <div class="hash-chain__data">
                    <span class="hash-chain__data-value" data-text="$b1data">patient_created</span>
                    <button
                      class="hash-chain__tamper-btn"
                      data-on:click="$b1data = $b1data + '*'; $b2state = 'invalid'; $b3state = 'invalid'"
                      title="Tamper with this record"
                    >Tamper</button>
                    <span class="hash-chain__invalid-icon" aria-label="Invalid">&#x2717;</span>
                  </div>
                  <div class="hash-chain__formula">H(prev + data)</div>
                </article>

                <div class="hash-chain__connector" data-attr:data-state="$b2state" aria-hidden="true">
                  <div class="hash-chain__flow-line"></div>
                </div>

                <!-- Block 2 -->
                <article class="hash-chain__row" data-attr:data-state="$b2state">
                  <span class="hash-chain__index">#2</span>
                  <div class="hash-chain__hash">
                    <code>b5e7f1a3...</code>
                  </div>
                  <div class="hash-chain__data">
                    <span class="hash-chain__data-value" data-text="$b2data">lab_results</span>
                    <button
                      class="hash-chain__tamper-btn"
                      data-on:click="$b2data = $b2data + '*'; $b3state = 'invalid'"
                      title="Tamper with this record"
                    >Tamper</button>
                    <span class="hash-chain__invalid-icon" aria-label="Invalid">&#x2717;</span>
                  </div>
                  <div class="hash-chain__formula">H(prev + data)</div>
                </article>

                <div class="hash-chain__connector" data-attr:data-state="$b3state" aria-hidden="true">
                  <div class="hash-chain__flow-line"></div>
                </div>

                <!-- Block 3 -->
                <article class="hash-chain__row" data-attr:data-state="$b3state">
                  <span class="hash-chain__index">#3</span>
                  <div class="hash-chain__hash">
                    <code>c2d9e8f4...</code>
                  </div>
                  <div class="hash-chain__data">
                    <span class="hash-chain__data-value" data-text="$b3data">prescription</span>
                    <button
                      class="hash-chain__tamper-btn"
                      data-on:click="$b3data = $b3data + '*'"
                      title="Tamper with this record"
                    >Tamper</button>
                    <span class="hash-chain__invalid-icon" aria-label="Invalid">&#x2717;</span>
                  </div>
                  <div class="hash-chain__formula">H(prev + data)</div>
                </article>
              </div>
            </div>

          </figure>
      </div>

      <!-- Simulation Testing -->
      <div class="deep-dive-section" id="simulation-testing">
        <h3 class="deep-dive-section__title">Deterministic Simulation Testing</h3>
        <p class="text-muted mb-m">
          We test Craton using deterministic simulation&mdash;running months of simulated time in seconds
          to find edge cases that would take years to hit in production.
          <strong>Bugs found before they reach you.</strong>
        </p>

        {% include "partials/figures/simulation-clock.html" %}
      </div>

      <!-- Log-First Architecture -->
      <div class="deep-dive-section" id="log-state">
        <h3 class="deep-dive-section__title">Log-First Architecture</h3>
        <p class="text-muted mb-m">
          The log is the <strong>source of truth</strong>.
          State is just a convenient, rebuildable cache. Your data is always recoverable.
        </p>

          <figure
            class="interactive-section__figure"
            data-signals="{viewOffset: 5, projectionType: 'table'}"
          >
            <header class="interactive-section__figure-header">
              <span class="interactive-section__fig-label">Fig. 10</span>
              <span class="interactive-section__fig-caption">Drag the time-travel slider to see the state at any point in history.</span>
            </header>

            <div class="interactive-section__figure-content">
            <div class="log-state">
              <!-- Log Panel (Left) -->
              <aside class="log-state__panel" aria-label="Append-only event log">
                <header class="log-state__panel-header">
                  <h3 class="log-state__panel-title">Append-Only Log</h3>
                  <span class="badge">Source of Truth</span>
                </header>

                <div class="log-state__panel-body">
                  <ol class="log-state__events" role="list">
                    <li class="log-state__event">
                      <span class="log-state__event-offset">#0</span>
                      <span class="log-state__event-type">StreamCreated</span>
                      <time class="log-state__event-time">09:15:32</time>
                    </li>
                    <li class="log-state__event" data-attr:style="$viewOffset < 1 ? 'opacity: 0.3' : ''">
                      <span class="log-state__event-offset">#1</span>
                      <span class="log-state__event-type">RecordAdded</span>
                      <time class="log-state__event-time">09:16:45</time>
                    </li>
                    <li class="log-state__event" data-attr:style="$viewOffset < 2 ? 'opacity: 0.3' : ''">
                      <span class="log-state__event-offset">#2</span>
                      <span class="log-state__event-type">RecordUpdated</span>
                      <time class="log-state__event-time">09:18:02</time>
                    </li>
                    <li class="log-state__event" data-attr:style="$viewOffset < 3 ? 'opacity: 0.3' : ''">
                      <span class="log-state__event-offset">#3</span>
                      <span class="log-state__event-type">RecordAdded</span>
                      <time class="log-state__event-time">09:22:17</time>
                    </li>
                    <li class="log-state__event" data-attr:style="$viewOffset < 4 ? 'opacity: 0.3' : ''">
                      <span class="log-state__event-offset">#4</span>
                      <span class="log-state__event-type">AccessLogged</span>
                      <time class="log-state__event-time">09:25:33</time>
                    </li>
                  </ol>
                </div>

                <div class="log-state__time-travel">
                  <div class="log-state__time-travel-label">
                    <span>Time travel to offset:</span>
                    <output class="log-state__time-travel-value" data-text="$viewOffset">5</output>
                  </div>
                  <input
                    type="range"
                    min="0"
                    max="5"
                    data-bind:view-offset
                    aria-label="Time travel slider"
                  >
                </div>
              </aside>

              <!-- State Panel (Right) -->
              <main class="log-state__panel" aria-label="Derived projection">
                <header class="log-state__panel-header">
                  <h3 class="log-state__panel-title">Derived View</h3>
                  <div class="log-state__toggle">
                    <button
                      class="log-state__toggle-btn"
                      data-attr:data-active="$projectionType === 'table'"
                      data-on:click="$projectionType = 'table'"
                    >Table</button>
                    <button
                      class="log-state__toggle-btn"
                      data-attr:data-active="$projectionType === 'counts'"
                      data-on:click="$projectionType = 'counts'"
                    >Counts</button>
                  </div>
                </header>

                <div class="log-state__panel-body">
                  <!-- Table projection -->
                  <table class="log-state__table" data-show="$projectionType === 'table'">
                    <thead>
                      <tr>
                        <th>Field</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr data-show="$viewOffset >= 1">
                        <td>patient_name</td>
                        <td>John Doe</td>
                      </tr>
                      <tr data-show="$viewOffset >= 2">
                        <td>vitals</td>
                        <td data-text="$viewOffset >= 3 ? '120/80' : '(pending)'">(pending)</td>
                      </tr>
                      <tr data-show="$viewOffset >= 4">
                        <td>labs</td>
                        <td>ordered</td>
                      </tr>
                      <tr data-show="$viewOffset >= 5">
                        <td>last_access</td>
                        <td>Dr. Smith @ 09:25</td>
                      </tr>
                    </tbody>
                  </table>

                  <!-- Counts projection -->
                  <dl class="log-state__counts flow" data-space="s" data-show="$projectionType === 'counts'">
                    <div class="repel">
                      <dt>Total Events</dt>
                      <dd data-text="Math.min($viewOffset, 5)">5</dd>
                    </div>
                    <div class="repel">
                      <dt>Records</dt>
                      <dd data-text="$viewOffset >= 4 ? 2 : ($viewOffset >= 2 ? 1 : 0)">2</dd>
                    </div>
                    <div class="repel">
                      <dt>Updates</dt>
                      <dd data-text="$viewOffset >= 3 ? 1 : 0">1</dd>
                    </div>
                    <div class="repel">
                      <dt>Access Events</dt>
                      <dd data-text="$viewOffset >= 5 ? 1 : 0">1</dd>
                    </div>
                  </dl>
                </div>
              </main>
            </div>
            </div>
          </figure>
      </div>
    </div>

    <p class="text-muted mt-l">
      Want the full technical details? See the <a href="/architecture">Architecture Deep Dive</a>.
    </p>
  </div>
</section>

<!-- Open Source -->
<section class="interactive-section" aria-labelledby="oss-heading">
  <div class="wrapper">
    <div class="flow" data-space="xl">
      <header class="interactive-section__header flow" data-space="s">
        <h2 id="oss-heading" class="section-title">Open Source & Licensing</h2>
        <p class="section-subtitle">
          Open-core model with a clear philosophy: <strong>You are not buying software. You are buying assurance.</strong>
        </p>
      </header>

      <div class="grid" data-layout="halves">
        <div class="card flow" data-variant="feature" data-space="m">
          <header class="repel">
            <h3>Open Source Core</h3>
            <span class="badge" data-variant="outline">Apache 2.0</span>
          </header>
          <div class="feature-list flow" data-space="s">
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
              <span>Replicated log with hash chaining</span>
            </div>
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
              <span>Projection engine</span>
            </div>
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
              <span>SQL subset query layer</span>
            </div>
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x2192;</span>
              <span>SDKs for common languages</span>
            </div>
          </div>
          <p class="text-muted"><em>The open source version is correct and complete. Nothing is artificially limited.</em></p>
        </div>
        <div class="card flow" data-variant="feature" data-space="m">
          <header class="repel">
            <h3>Commercial Assurance</h3>
          </header>
          <p class="text-muted">Paid offerings transfer operational burden:</p>
          <div class="feature-list flow" data-space="s">
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x25A0;</span>
              <span><strong>Compliance Tooling</strong> &mdash; Sealing, audit reports, exports</span>
            </div>
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x25A0;</span>
              <span><strong>Key Management</strong> &mdash; KMS/HSM integration, rotation</span>
            </div>
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x25A0;</span>
              <span><strong>Attestations</strong> &mdash; Third-party timestamp anchoring</span>
            </div>
            <div class="feature-list__item">
              <span class="feature-list__icon" aria-hidden="true">&#x25A0;</span>
              <span><strong>Managed Cloud</strong> &mdash; We operate it. SLAs included.</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Philosophy Quote -->
<section class="quote-section">
  <div class="wrapper">
    <blockquote class="pullquote">
      <p>If you cannot explain where a piece of data came from, you do not control it.</p>
    </blockquote>
    <p class="text-muted mt-m">
      Craton is built so that you always can.
    </p>
  </div>
</section>

<!-- CTA -->
<section class="interactive-section" aria-labelledby="cta-heading">
  <div class="wrapper">
    <div class="center flow" data-space="l">
      <h2 id="cta-heading">Ready to Explore?</h2>
      <p class="text-muted">
        Craton is under active development. Star the repo to follow our progress,
        or read the blog for deep dives into our architecture.
      </p>
      <div class="cluster" data-justify="center">
        <a href="https://github.com/craton-db/craton" class="button" data-variant="primary">
          Star on GitHub
        </a>
        <a href="/blog" class="button" data-variant="secondary">
          Read the Blog
        </a>
      </div>
    </div>
  </div>
</section>
{% endblock %}
